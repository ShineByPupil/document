# ç”Ÿå‘½å‘¨æœŸ

## æ³¨å†Œå‘¨æœŸé’©å­

```vue
<script setup>
import { onMounted } from 'vue'

onMounted(() => {
  console.log(`the component is now mounted.`)
})
</script>
```

## ä¸€ã€åˆå§‹åŒ–é˜¶æ®µ

### setup()

- **è§¦å‘æ—¶æœº**ï¼šç»„ä»¶åˆå§‹åŒ–æ—¶æœ€å…ˆæ‰§è¡Œ
- **åº”ç”¨åœºæ™¯**ï¼šç”¨äºå®šä¹‰å“åº”å¼æ•°æ®ã€æ–¹æ³•ã€è®¡ç®—å±æ€§ç­‰ï¼ˆæ›¿ä»£ Vue 2 çš„ `beforeCreate` å’Œ `created`ï¼‰

### onBeforeMount()

- **è§¦å‘æ—¶æœº**ï¼šåœ¨ç»„ä»¶è¢«æŒ‚è½½ä¹‹å‰è¢«è°ƒç”¨
- **ç±»å‹å£°æ˜**
  ```ts
  function onBeforeMount(callback: () => void): void
  ```

### onMounted()

- **è§¦å‘æ—¶æœº**ï¼šåœ¨ç»„ä»¶æŒ‚è½½å®Œæˆåæ‰§è¡Œ
- **ç±»å‹å£°æ˜**
  ```ts
  function onMounted(callback: () => void): void
  ```
- **åº”ç”¨åœºæ™¯**ï¼š
  - è®¿é—®/æ“ä½œ DOM å…ƒç´ 
  - åˆå§‹åŒ–ç¬¬ä¸‰æ–¹åº“ï¼ˆå›¾è¡¨åº“ã€åœ°å›¾åº“ï¼‰
  - å‘èµ· API è¯·æ±‚è·å–æ•°æ®

## äºŒã€æ›´æ–°é˜¶æ®µ

### onBeforeUpdate()

- **è§¦å‘æ—¶æœº**ï¼šåœ¨ç»„ä»¶å³å°†å› ä¸ºå“åº”å¼çŠ¶æ€å˜æ›´è€Œæ›´æ–°å…¶ DOM æ ‘ä¹‹å‰è°ƒç”¨
- **ç±»å‹å£°æ˜**
  ```ts
  function onBeforeUpdate(callback: () => void): void
  ```
- **åº”ç”¨åœºæ™¯**ï¼šåœ¨ DOM æ›´æ–°å‰è·å–å½“å‰çŠ¶æ€

### onUpdated()

- **è§¦å‘æ—¶æœº**ï¼šåœ¨ç»„ä»¶å› ä¸ºå“åº”å¼çŠ¶æ€å˜æ›´è€Œæ›´æ–°å…¶ DOM æ ‘ä¹‹åè°ƒç”¨
- **ç±»å‹å£°æ˜**
  ```ts
  function onUpdated(callback: () => void): void
  ```
- **åº”ç”¨åœºæ™¯**ï¼š
  - æ‰§è¡Œä¾èµ–äº DOM æ›´æ–°çš„æ“ä½œ
  - æ‰‹åŠ¨ç»´æŠ¤çš„é Vue æ§åˆ¶çš„ DOM æ›´æ–°

## ä¸‰ã€å¸è½½é˜¶æ®µ

### onBeforeUnmount()

- **è§¦å‘æ—¶æœº**ï¼šåœ¨ç»„ä»¶å®ä¾‹è¢«å¸è½½ä¹‹å‰è°ƒç”¨
- **ç±»å‹å£°æ˜**
  ```ts
  function onBeforeUnmount(callback: () => void): void
  ```

### onUnmounted()

- **è§¦å‘æ—¶æœº**ï¼šåœ¨ç»„ä»¶å®ä¾‹è¢«å¸è½½ä¹‹åè°ƒç”¨
- **ç±»å‹å£°æ˜**
  ```ts
  function onUnmounted(callback: () => void): void
  ```

## å››ã€ç¼“å­˜ç»„ä»¶æ§åˆ¶

### onActivated()

- **è§¦å‘æ—¶æœº**ï¼šè‹¥ç»„ä»¶å®ä¾‹æ˜¯ `<KeepAlive>` ç¼“å­˜æ ‘çš„ä¸€éƒ¨åˆ†ï¼Œå½“ç»„ä»¶è¢«æ’å…¥åˆ° DOM ä¸­æ—¶è°ƒç”¨
- **ç±»å‹å£°æ˜**
  ```ts
  function onActivated(callback: () => void): void
  ```

### onDeactivated()

- **è§¦å‘æ—¶æœº**ï¼šè‹¥ç»„ä»¶å®ä¾‹æ˜¯ `<KeepAlive>` ç¼“å­˜æ ‘çš„ä¸€éƒ¨åˆ†ï¼Œå½“ç»„ä»¶ä» DOM ä¸­è¢«ç§»é™¤æ—¶è°ƒç”¨
- **ç±»å‹å£°æ˜**
  ```ts
  function onDeactivated(callback: () => void): void
  ```

:::warning æ³¨æ„äº‹é¡¹
è¿™ä¸ªé’©å­åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æœŸé—´ä¸ä¼šè¢«è°ƒç”¨
:::

## äº”ã€é”™è¯¯é˜¶æ®µ

### onErrorCaptured()

:::warning æ³¨æ„äº‹é¡¹
åªèƒ½æ•è·å­ç»„ä»¶æ ‘çš„é”™è¯¯ï¼Œè€Œæ— æ³•æ•è·å½“å‰ç»„ä»¶è‡ªèº«çš„é”™è¯¯
:::

- **è§¦å‘æ—¶æœº**ï¼šåœ¨æ•è·äº†åä»£ç»„ä»¶ä¼ é€’çš„é”™è¯¯æ—¶è°ƒç”¨
- **ç±»å‹å£°æ˜**

  ```ts
  function onErrorCaptured(callback: ErrorCapturedHook): void

  type ErrorCapturedHook = (
    err: unknown, // è¢«æ•è·çš„é”™è¯¯å¯¹è±¡
    instance: ComponentPublicInstance | null, // è§¦å‘é”™è¯¯çš„ç»„ä»¶å®ä¾‹
    /**
     * é”™è¯¯æ¥æºä¿¡æ¯ï¼š
     * - ç”Ÿå‘½å‘¨æœŸé’©å­é”™è¯¯: "lifecycle hook"
     * - äº‹ä»¶å¤„ç†å™¨é”™è¯¯: "event handler"
     * - å¼‚æ­¥å›è°ƒé”™è¯¯: "async function or promise chain"
     * - æ¸²æŸ“å‡½æ•°é”™è¯¯: "render function"
     * - ä¾¦å¬å™¨é”™è¯¯: "watcher callback"
     */
    info: string, // é”™è¯¯æ¥æºä¿¡æ¯
  ) => boolean | void // è¿”å› false å°†é˜»æ­¢é”™è¯¯ç»§ç»­å‘ä¸Šä¼ æ’­
  ```

## å…­ã€æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰

:::warning æ³¨æ„äº‹é¡¹
æœåŠ¡ç«¯æ¸²æŸ“å¤§å¤šé’©å­æ— æ³•ä½¿ç”¨ï¼Œé™¤äº† `setup()` `onErrorCaptured` `onServerPrefetch`
:::

### onServerPrefetch()

- **è§¦å‘æ—¶æœº**ï¼šåœ¨ç»„ä»¶å®ä¾‹åœ¨æœåŠ¡å™¨ä¸Šè¢«æ¸²æŸ“ä¹‹å‰è°ƒç”¨
- **ç±»å‹å£°æ˜**
  ```ts
  function onServerPrefetch(callback: () => Promise<any>): void
  ```

## ä¸ƒã€è°ƒè¯•é’©å­ ğŸ”§

:::warning æ³¨æ„äº‹é¡¹
é’©å­ä»…åœ¨**å¼€å‘æ¨¡å¼**ä¸‹å¯ç”¨
:::

### onRenderTriggered()

- **è§¦å‘æ—¶æœº**ï¼šå½“å“åº”å¼ä¾èµ–çš„å˜æ›´è§¦å‘äº†ç»„ä»¶æ¸²æŸ“æ—¶è°ƒç”¨
- **åº”ç”¨åœºæ™¯**ï¼š
  - è°ƒè¯•ç»„ä»¶ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
  - è¿½è¸ªå“åº”å¼ä¾èµ–çš„å˜åŒ–æ¥æº
  - åˆ†æç»„ä»¶æ›´æ–°æ€§èƒ½é—®é¢˜
- **ç±»å‹å£°æ˜**

  ```ts
  function onRenderTriggered(callback: DebuggerHook): void

  type DebuggerHook = (e: DebuggerEvent) => void

  type DebuggerEvent = {
    effect: ReactiveEffect // å˜æ›´çš„å“åº”å¼ä¾èµ–
    target: object // è§¦å‘å˜æ›´çš„å“åº”å¼å¯¹è±¡
    /**
     * å˜æ›´çš„æ“ä½œç±»å‹ï¼š
     * - 'set'    : å¯¹å·²å­˜åœ¨çš„å±æ€§è¿›è¡Œèµ‹å€¼ï¼ˆå¦‚ `obj.key = value` æˆ– `map.set(existingKey, value)`ï¼‰
     * - 'add'    : å‘é›†åˆä¸­æ·»åŠ æ–°å…ƒç´ ï¼ˆå¦‚ `array.push()`ã€`map.set(newKey, value)` æˆ– `set.add(value)`ï¼‰
     * - 'delete' : åˆ é™¤å±æ€§æˆ–é›†åˆä¸­çš„å…ƒç´ ï¼ˆå¦‚ `delete obj.key`ã€`map.delete(key)` æˆ– `set.delete(value)`ï¼‰
     * - 'clear'  : æ¸…ç©ºæ•´ä¸ªé›†åˆï¼ˆå¦‚ `map.clear()` æˆ– `set.clear()`ï¼‰
     */
    type: TriggerOpTypes
    key: any // å˜æ›´çš„å±æ€§çš„é”®å
    // å˜æ›´åçš„æ–°å€¼ï¼ˆä»…åœ¨'set'å’Œ'add'æ“ä½œæ—¶å­˜åœ¨ï¼‰
    newValue?: any
    // å˜æ›´å‰çš„æ—§å€¼ï¼ˆä»…åœ¨'set'å’Œ'delete'æ“ä½œæ—¶å­˜åœ¨ï¼‰
    oldValue?: any
    // æ¸…ç©ºæ“ä½œå‰çš„é›†åˆçŠ¶æ€ï¼ˆä»…åœ¨'clear'æ“ä½œæ—¶å­˜åœ¨ï¼‰
    oldTarget?: Map<any, any> | Set<any>
  }
  ```

### onRenderTracked()

- **è§¦å‘æ—¶æœº**ï¼šå½“ç»„ä»¶æ¸²æŸ“è¿‡ç¨‹ä¸­è¿½è¸ªåˆ°å“åº”å¼ä¾èµ–æ—¶è°ƒç”¨
- **åº”ç”¨åœºæ™¯**ï¼š
  - åˆ†æç»„ä»¶ä¾èµ–å…³ç³»
  - æ£€æµ‹ä¸å¿…è¦çš„ä¾èµ–è¿½è¸ª
  - è°ƒè¯•è®¡ç®—å±æ€§çš„ä¾èµ–æ”¶é›†
- **ç±»å‹å£°æ˜**

  ```ts
  function onRenderTracked(callback: DebuggerHook): void

  type DebuggerHook = (e: DebuggerEvent) => void

  type DebuggerEvent = {
    effect: ReactiveEffect // è¢«è¿½è¸ªçš„å“åº”å¼ä¾èµ–
    target: object // è¢«è®¿é—®çš„å“åº”å¼å¯¹è±¡
    /**
     * è¿½è¸ªçš„æ“ä½œç±»å‹ï¼š
     * - 'get'     : è¯»å–å¯¹è±¡çš„å±æ€§å€¼ï¼ˆå¦‚ `obj.key`ï¼‰
     * - 'has'     : æ£€æŸ¥å¯¹è±¡/é›†åˆä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå±æ€§æˆ–é”®ï¼ˆå¦‚ `'key' in obj` æˆ–   `map.has(key)`ï¼‰
     * - 'iterate' : éå†é›†åˆï¼ˆå¦‚ `for...of` å¾ªç¯ã€`Object.keys(obj)` æˆ– `map.entries()`ï¼‰
     */
    type: TrackOpTypes
    key: any // è¢«è®¿é—®çš„å±æ€§çš„é”®å
  }
  ```

## é™„å½•

### ä»£ç ç¤ºä¾‹

:::demo onlyShow
framework/vue3/lifecycle/index
:::

### å›¾ç¤º

![lifecycle.png](../../public/images/framework/vue3/lifecycle.png)

### æ¨ªå‘å¯¹æ¯”

| Vue 2           | Vue 3 (Options API) | Vue 3 (Composition API) |
| --------------- | ------------------- | ----------------------- |
| `beforeCreate`  | `beforeCreate`      | è¢« `setup()` æ›¿ä»£       |
| `created`       | `created`           | è¢« `setup()` æ›¿ä»£       |
| `beforeMount`   | `beforeMount`       | `onBeforeMount`         |
| `mounted`       | `mounted`           | `onMounted`             |
| `beforeUpdate`  | `beforeUpdate`      | `onBeforeUpdate`        |
| `updated`       | `updated`           | `onUpdated`             |
| `beforeDestroy` | `beforeUnmount`     | `onBeforeUnmount`       |
| `destroyed`     | `unmounted`         | `onUnmounted`           |
| `activated`     | `activated`         | `onActivated`           |
| `deactivated`   | `deactivated`       | `onDeactivated`         |
| -               | -                   | `onRenderTracked`       |
| -               | -                   | `onRenderTriggered`     |

```

```
