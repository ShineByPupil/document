# 事件系统 - WEB API

## 事件流

- window -捕获-> target -冒泡-> window

## 事件绑定与解绑

- 事件类型
  - 鼠标事件：`click`、`mousedown`、`mouseup` 等
  - 键盘事件：`keydown`、`keyup` 等
  - 窗口事件：`resize` 等
  - 表单事件：`submit`、`reset` 等

```js
// dom0 事件绑定
btn.onclick = handleClick
btn.onclick = null

// dom2 事件绑定
btn.addEventListener('click', handleClick)
btn.removeEventListener('click', handleClick)
```

## 事件委托

> 利用**事件冒泡机制**，将子元素的事件处理程序绑定到父元素的优化技术。通过减少事件监听器数量提升性能，特别适用于动态内容和批量元素处理场景。

```html
<ul id="task-list">
  <li data-id="1">
    任务1
    <button class="delete">×</button>
  </li>
  <li data-id="2">
    任务2
    <button class="delete">×</button>
  </li>
  <li data-id="3">
    任务3
    <button class="delete">×</button>
  </li>
</ul>

<script>
  document.getElementById('task-list').addEventListener('click', function (e) {
    // 事件目标识别
    const listItem = e.target.closest('li')
    const deleteBtn = e.target.closest('.delete')

    // 列表项点击
    if (listItem) {
      console.log('选中任务:', listItem.dataset.id)
    }

    // 删除按钮点击
    if (deleteBtn) {
      const itemId = deleteBtn.closest('li').dataset.id
      console.log('删除任务:', itemId)
      deleteBtn.closest('li').remove()
    }
  })
</script>
```

## 自定义事件

```ts
interface EventInit {
  bubbles?: boolean // 事件是否冒泡，默认为 false
  cancelable?: boolean // 事件是否可取消，默认为 false
  composed?: boolean // 事件能否跨越 Shadow DOM 的边界，默认为 false
}

interface CustomEventInit extends EventInit {
  detail?: any // 事件的详细信息
}
```

- EventInit

```js
const myEvent = new Event('myEvent')
document.addEventListener('myEvent', function (params) {
  console.log(params)
})
document.dispatchEvent(myEvent)
```

- CustomEvent

```js
const myEvent = new CustomEvent('myEvent', { detail: 'data' })
document.addEventListener('myEvent', function (e) {
  console.log(e.detail)
})
document.dispatchEvent(myEvent)
```

- `Event.prototype.preventDefault()`
  - 阻止事件的默认行为
- `Event.prototype.stopPropagation()`
  - 阻止事件在捕获或冒泡阶段的进一步传播，但同一元素的其他监听器仍会执行
- `Event.prototype.stopImmediatePropagation()`
  - 在 `stopPropagation()` 基础上，额外阻止同一元素上后续注册的监听器执行（依赖添加顺序）
- `Event.prototype.composedPath()`
  - 返回事件传播路径的节点数组（从目标到根节点）
  - 事件发生在 `Shadow DOM` 内部时
    - `composed: false`，路径仅包含 Shadow Tree 内部的节点
    - `composed: true`，路径穿透 Shadow Tree，包含外部宿主元素
