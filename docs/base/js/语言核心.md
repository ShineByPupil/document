# è¯­è¨€æ ¸å¿ƒ - JavaScript

## ä¸€ã€å˜é‡å£°æ˜

::: tip å†å²èƒŒæ™¯

ä»ES5çš„ `var` åˆ°ES6çš„ `let/const` ï¼ŒJavaScriptçš„å˜é‡å£°æ˜æœºåˆ¶ç»å†äº†é‡å¤§æ”¹è¿›ï¼Œä¸»è¦è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š

1. å˜é‡æå‡å¯¼è‡´çš„æ„å¤–è¡Œä¸º
2. å…¨å±€æ±¡æŸ“é—®é¢˜ï¼ˆå°¤å…¶æµè§ˆå™¨ç¯å¢ƒï¼‰
3. å¾ªç¯ä½œç”¨åŸŸé—®é¢˜
4. ç¼ºä¹çœŸæ­£çš„å¸¸é‡å£°æ˜

:::

| ç‰¹æ€§         | **`var`** | **`let`** | **`const`** |
| ------------ | --------- | --------- | ----------- |
| ä½œç”¨åŸŸ       | å‡½æ•°çº§    | å—çº§      | å—çº§        |
| é‡å¤å£°æ˜     | å…è®¸âœ…    | ç¦æ­¢ğŸš«    | ç¦æ­¢ğŸš«      |
| æš‚æ—¶æ€§æ­»åŒº   | æ— âŒ      | æœ‰âœ…      | æœ‰âœ…        |
| å…¨å±€å±æ€§ç»‘å®š | æ˜¯        | å¦        | å¦          |

```js [å£°æ˜å¯¹æ¯”]
// ES5æ–¹å¼ï¼ˆå­˜åœ¨å˜é‡æå‡ï¼‰
console.log(hoistedVar) // undefined
var hoistedVar = 10

// ES6æ–¹å¼ï¼ˆå—çº§ä½œç”¨åŸŸï¼‰
{
  let blockScoped = 20
  const PI = 3.1415926
}

console.log(blockScoped) // ReferenceError
```

::: warning æ³¨æ„äº‹é¡¹

1. constå£°æ˜å¯¹è±¡æ—¶ï¼Œå±æ€§ä»å¯ä¿®æ”¹ï¼ˆéœ€é…åˆObject.freezeï¼‰
2. é¿å…åœ¨å¾ªç¯ä¸­ä½¿ç”¨varå£°æ˜è¿­ä»£å˜é‡

:::

## äºŒã€æ•°æ®ç±»å‹

### 1. åŸºæœ¬ç±»å‹

ä¸ƒå¤§ç±»ï¼š`String` \| `Number` \| `Boolean` \| `null` \| `underfind` \| `Symbol`(ES6+) \| `BigInt`(ES2020+)

### 2. å¼•ç”¨ç±»å‹

`Object` \| `Array` \| `Function` \| `Map` \| `WeakMap` \| `Set` \| `Date` \| `RegExp` \| `Promise`

### 3. ç±»å‹åˆ¤æ–­

- `typeof`

```js
typeof 'str' // "string"
typeof 42 // "number"
typeof true // "boolean"
typeof Symbol() // "symbol"
typeof {} // "object"
typeof [] // "object" (æ³¨æ„æ•°ç»„åˆ¤æ–­éœ€ç”¨Array.isArray())
typeof null // "object"
typeof undefined // "undefined"
```

:::warning æ³¨æ„äº‹é¡¹

æ— æ³•åŒºåˆ†æ•°ç»„ã€nullä¸object

:::

- `Object.prototype.toString.call()`

```js
Object.prototype.toString.call('str') // "[object String]"
Object.prototype.toString.call(42) // "[object Number]"
Object.prototype.toString.call(true) // "[object Boolean]"
Object.prototype.toString.call(Symbol()) // "[object Symbol]"
Object.prototype.toString.call({}) // "[object Object]"
Object.prototype.toString.call([]) // "[object Array]"
```

- `instanceof`

```js
;[] instanceof Array // true
;[] instanceof Object // true
'str' instanceof String // false
new Object('str') instanceof String // true
```

:::warning æ³¨æ„äº‹é¡¹

1. åŸºæœ¬ç±»å‹æ— æ•ˆ
2. è·¨çª—å£/æ¡†æ¶å¯¹è±¡æ£€æµ‹å¤±æ•ˆï¼ˆä¸åŒä¸Šä¸‹æ–‡çš„æ„é€ å‡½æ•°ä¸å…±äº«åŸå‹é“¾ï¼‰
3. æ˜¾å¼ä¿®æ”¹åŸå‹é“¾å¯èƒ½å¯¼è‡´è¯¯åˆ¤ï¼ˆæ‰‹åŠ¨ä¿®æ”¹å¯¹è±¡çš„ `__proto__` æˆ–ä½¿ç”¨ `Object.setPrototypeOf` ä¼šå½±å“ `instanceof` çš„ç»“æœï¼‰

:::

- `Array.isArray()`

```js
Array.isArray([]) // true
Array.isArray('str') // false
```

- `Number.isNaN` å’Œ `isNaN`

```js
isNaN(NaN) // true
Number.isNaN(NaN) // true
isNaN('str') // true
Number.isNaN('str') // false
```

## ä¸‰ã€ä½œç”¨åŸŸ

### 1. è¯æ³•ç¯å¢ƒ

> æ˜¯ JavaScript ä¸­ä½œç”¨åŸŸçš„å®ç°æœºåˆ¶ï¼Œå®ƒå†³å®šäº†ä»£ç åœ¨ä½•å¤„ä»¥åŠå¦‚ä½•æŸ¥æ‰¾å˜é‡

- ç¯å¢ƒè®°å½•ï¼ˆEnvironment Recordï¼‰
  - å­˜å‚¨å½“å‰ä½œç”¨åŸŸå†…å£°æ˜çš„å˜é‡ã€å‡½æ•°ã€å‚æ•°ç­‰æ ‡è¯†ç¬¦ï¼ˆå¦‚ `let`/`const`/`function`ï¼‰
- å¯¹å¤–éƒ¨è¯æ³•ç¯å¢ƒçš„å¼•ç”¨ï¼ˆOuter Referenceï¼‰
  - `outer` æŒ‡å‘å¤–å±‚ä½œç”¨åŸŸçš„è¯æ³•ç¯å¢ƒï¼Œå½¢æˆä½œç”¨åŸŸé“¾ï¼ˆScope Chainï¼‰ï¼Œå®ç°å˜é‡é€å±‚å‘ä¸ŠæŸ¥æ‰¾

### 2. ä½œç”¨åŸŸç±»å‹

| ç‰¹å¾         | å…¨å±€ä½œç”¨åŸŸ     | å‡½æ•°ä½œç”¨åŸŸ       | å—çº§ä½œç”¨åŸŸï¼ˆES6+ï¼‰ |
| ------------ | -------------- | ---------------- | ------------------ |
| ä½œç”¨åŸŸè¾¹ç•Œ   | æœ€å¤–å±‚         | `function` å†…éƒ¨  | `{}` å†…éƒ¨          |
| ç”Ÿå‘½å‘¨æœŸ     | é¡µé¢å…³é—­æ—¶é”€æ¯ | å‡½æ•°æ‰§è¡Œç»“æŸé”€æ¯ | å—æ‰§è¡Œç»“æŸé”€æ¯     |
| å…¸å‹åº”ç”¨åœºæ™¯ | å…¨å±€é…ç½®é¡¹     | å°è£…å‡½æ•°å†…éƒ¨é€»è¾‘ | å¾ªç¯ã€æ¡ä»¶è¯­å¥ç­‰   |

### 3. ä½œç”¨åŸŸé“¾

> ä½œç”¨åŸŸé“¾æ˜¯ å‡½æ•°åœ¨å®šä¹‰æ—¶å½¢æˆçš„åµŒå¥—ä½œç”¨åŸŸå±‚çº§ç»“æ„ï¼Œé€šè¿‡ç”±å†…å‘å¤–é€çº§æŸ¥æ‰¾å˜é‡ï¼Œç¡®ä¿å†…éƒ¨ä½œç”¨åŸŸèƒ½è®¿é—®å¤–å±‚å˜é‡ï¼Œè€Œå¤–å±‚æ— æ³•è®¿é—®å†…å±‚ã€‚

```js
let globalVar = 'global'

function outer() {
  let outerVar = 'outer'

  function inner() {
    let innerVar = 'inner'
    console.log(globalVar) // é€šè¿‡ä½œç”¨åŸŸé“¾å‘ä¸ŠæŸ¥æ‰¾
  }

  inner()
}

outer()
```

### 4. this æŒ‡å‘

ç»‘å®šè§„åˆ™

| è°ƒç”¨æ–¹å¼        | this æŒ‡å‘        | ç¤ºä¾‹                |
| --------------- | ---------------- | ------------------- |
| æ™®é€šå‡½æ•°è°ƒç”¨    | window/undefined | `func()`            |
| æ–¹æ³•è°ƒç”¨        | è°ƒç”¨å¯¹è±¡         | `obj.method()`      |
| new è°ƒç”¨        | æ–°åˆ›å»ºå®ä¾‹       | `new Constructor()` |
| call/apply/bind | æŒ‡å®šå¯¹è±¡         | `func.call(ctx)`    |

## å››ã€é—­åŒ…

> é—­åŒ…æ˜¯å‡½æ•°ä¸å…¶å£°æ˜æ—¶è¯æ³•ç¯å¢ƒçš„**ç»‘å®šå…³ç³»**ï¼Œä½¿å¾—å‡½æ•°å¯ä»¥æŒç»­è®¿é—®å…¶å¤–éƒ¨ä½œç”¨åŸŸçš„å˜é‡ï¼Œå³ä½¿å¤–å±‚å‡½æ•°å·²æ‰§è¡Œå®Œæ¯•ã€‚
> è¿™ç§æœºåˆ¶é€šè¿‡ç»´æŒå˜é‡å¼•ç”¨é˜»æ­¢åƒåœ¾å›æ”¶ï¼Œæ˜¯ JavaScript å®ç°æ¨¡å—åŒ–å’ŒçŠ¶æ€ä¿æŒçš„æ ¸å¿ƒæ¨¡å¼ã€‚

### 1. é—­åŒ…åº”ç”¨

#### 1.1 æ¨¡æ‹Ÿç§æœ‰å­—æ®µ

- å¯¹å¤–æš´éœ²æœ‰é™æ¥å£
- å†…éƒ¨ç»´æŠ¤ç§æœ‰å˜é‡

:::details æ¨¡æ‹Ÿç§æœ‰å­—æ®µ

```js
function createCounter() {
  let count = 0 // é—­åŒ…ä¸­çš„ç§æœ‰å˜é‡
  return {
    increment() {
      count++
    },
    get value() {
      return count
    },
  }
}
const counter = createCounter()
counter.increment()
console.log(counter.value) // 1
console.log(counter.count) // undefinedï¼ˆæ— æ³•ç›´æ¥è®¿é—®ï¼‰
```

:::

#### 1.2 æ•°æ®æŒä¹…åŒ–ä¸çŠ¶æ€ç®¡ç†

- ç¼“å­˜æœºåˆ¶
- é…ç½®ä¿¡æ¯çš„é•¿æœŸå­˜å‚¨

:::details æ•°æ®æŒä¹…åŒ–ä¸çŠ¶æ€ç®¡ç†

```js
function createUserPrefs() {
  const prefs = {} // é—­åŒ…ä¸­æŒä¹…åŒ–å­˜å‚¨ç”¨æˆ·åå¥½
  return {
    set(key, value) {
      prefs[key] = value
    }, // è®¾ç½®åå¥½
    get(key) {
      return prefs[key]
    }, // è¯»å–åå¥½
    getAll() {
      return { ...prefs }
    }, // è¿”å›å‰¯æœ¬ï¼Œé¿å…ç›´æ¥ä¿®æ”¹
  }
}
const userPrefs = createUserPrefs()
userPrefs.set('theme', 'dark')
console.log(userPrefs.get('theme')) // 'dark'
```

:::

#### 1.3 æ¨¡å—åŒ–å¼€å‘

- éš”ç¦»æ¨¡å—å†…éƒ¨é€»è¾‘
- ä»…æš´éœ²å¿…è¦æ¥å£
- é¿å…å…¨å±€æ±¡æŸ“

:::details æ¨¡å—åŒ–å¼€å‘

```js
const MyModule = (function () {
  let internalData = 'secret' // æ¨¡å—ç§æœ‰æ•°æ®
  function privateMethod() {
    /* ... */
  }
  return {
    publicMethod() {
      privateMethod()
      return internalData
    },
  }
})()
console.log(MyModule.publicMethod()) // 'secret'
console.log(MyModule.internalData) // undefined
```

:::

#### 1.4 å‡½æ•°å·¥å‚

- åˆ›å»ºå¸¦æœ‰é¢„è®¾å‚æ•°çš„å¤„ç†å™¨
- ç”Ÿæˆä¸åŒè¡Œä¸ºçš„å·¥å…·å‡½æ•°

:::details å‡½æ•°å·¥å‚

```js
function createMultiplier(factor) {
  return function (number) {
    return number * factor // é—­åŒ…ä¿ç•™ factor çš„å€¼
  }
}
const double = createMultiplier(2)
const triple = createMultiplier(3)
console.log(double(5)) // 10ï¼ˆfactor=2 è¢«é—­åŒ…ä¿ç•™ï¼‰
```

- é˜²æŠ–
  - æ‰§è¡Œæ—¶æœºï¼šåœæ­¢è§¦å‘å wait æ—¶é—´æ‰§è¡Œ
  - é«˜é¢‘è§¦å‘æ•ˆæœï¼šåªæ‰§è¡Œæœ€åä¸€æ¬¡
  - é€‚ç”¨åœºæ™¯ï¼šæœç´¢æ¡†è¾“å…¥è”æƒ³

```js
function debounce(func, wait) {
  let timeoutID = null

  return function () {
    timeoutID && clearTimeout(timeoutID)
    timeoutID = setTimeout(func, wait)
  }
}
```

- èŠ‚æµ
  - æ‰§è¡Œæ—¶æœºï¼šæ¯éš” wait æ—¶é—´æ‰§è¡Œä¸€æ¬¡
  - é«˜é¢‘è§¦å‘æ•ˆæœï¼šå‡åŒ€é—´éš”æ‰§è¡Œ
  - é€‚ç”¨åœºæ™¯ï¼šæ»šåŠ¨äº‹ä»¶

```js
function throttle(func, wait) {
  let timeoutID = null

  return function () {
    if (!timeoutID) {
      timeoutID = setTimeout(() => {
        func()
        timeoutID = 0
      }, wait)
    }
  }
}
```

:::

### 2. é—­åŒ…ä¸ç±»çš„åŒºåˆ«

| ç‰¹æ€§       | **é—­åŒ…**                           | **ç±»ï¼ˆClassï¼‰**                |
| ---------- | ---------------------------------- | ------------------------------ |
| çŠ¶æ€ç‹¬ç«‹æ€§ | æ¯æ¬¡è°ƒç”¨ç”Ÿæˆç‹¬ç«‹å®ä¾‹               | é€šè¿‡ `new` ç”Ÿæˆç‹¬ç«‹å®ä¾‹        |
| ç§æœ‰æ€§     | å˜é‡å¤©ç„¶ç§æœ‰ï¼ˆæ— æš´éœ²é€”å¾„ï¼‰         | éœ€è¦ `#` å‰ç¼€å£°æ˜ç§æœ‰å­—æ®µ      |
| å†…å­˜æ•ˆç‡   | æ¯ä¸ªå®ä¾‹ç‹¬ç«‹æŒæœ‰æ–¹æ³•ï¼ˆå†…å­˜å ç”¨é«˜ï¼‰ | æ–¹æ³•å…±äº«åœ¨åŸå‹ä¸Šï¼ˆå†…å­˜é«˜æ•ˆï¼‰   |
| ç»§æ‰¿       | æ— ç›´æ¥ç»§æ‰¿æœºåˆ¶ï¼Œéœ€æ‰‹åŠ¨ç»„åˆ         | æ”¯æŒ `extends` ç»§æ‰¿            |
| ä»£ç ç»“æ„   | é€‚åˆç®€å•é€»è¾‘ï¼Œå‡½æ•°å¼é£æ ¼           | é€‚åˆå¤æ‚å¯¹è±¡å»ºæ¨¡ï¼Œé¢å‘å¯¹è±¡é£æ ¼ |
| æ€§èƒ½       | é«˜é¢‘è°ƒç”¨æ—¶å¯èƒ½è¾ƒæ…¢ï¼ˆæ— ä¼˜åŒ–ï¼‰       | æ–¹æ³•è°ƒç”¨é€šå¸¸æ›´å¿«ï¼ˆå¼•æ“ä¼˜åŒ–ï¼‰   |
| åŠ¨æ€æ€§     | å¯åŠ¨æ€ç”Ÿæˆä¸åŒè¡Œä¸ºçš„å‡½æ•°           | è¡Œä¸ºç”±ç±»å®šä¹‰å›ºå®š               |

::: warning æ€§èƒ½è€ƒé‡

é—­åŒ…ä¼šå¯¼è‡´å†…å­˜é©»ç•™ï¼Œéœ€æ³¨æ„ï¼š

- é¿å…ä¸å¿…è¦çš„é—­åŒ…åµŒå¥—
- åŠæ—¶è§£é™¤ä¸å†ä½¿ç”¨çš„å¼•ç”¨
- ä½¿ç”¨Chrome DevTools Memoryé¢æ¿åˆ†æ

:::

## äº”ã€Class ç±»

| å®ç°æ–¹å¼ | **ES5 åŸå‹ç»§æ‰¿**   | **ES6 ç±»ç»§æ‰¿**     |
| -------- | ------------------ | ------------------ |
| è¯­æ³•     | å‡½æ•°+åŸå‹          | classè¯­æ³•ç³–        |
| é™æ€æ–¹æ³• | æ‰‹åŠ¨æ·»åŠ åˆ°æ„é€ å‡½æ•° | staticå…³é”®å­—       |
| ç§æœ‰å­—æ®µ | çº¦å®šå¼ï¼ˆ\_å‰ç¼€ï¼‰   | #è¯­æ³•æ”¯æŒ          |
| å…¼å®¹æ€§   | å…¨æµè§ˆå™¨æ”¯æŒ       | éœ€è¦transpilerè½¬æ¢ |
| å¯è¯»æ€§   | è¾ƒä½               | æ¥è¿‘ä¼ ç»ŸOOP        |

### 1. ES6 ç±»ç»§æ‰¿

- `class` å£°æ˜ç±»
- `extends` å®ç°ç±»ç»§æ‰¿ï¼Œè‡ªåŠ¨å¤„ç†åŸå‹é“¾
- `constructor` å®šä¹‰æ„é€ å‡½æ•°
- `super` åœ¨å­ç±»ä¸­è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•° `super(...args)` æˆ–æ–¹æ³• `super.method()`
- `static` å®šä¹‰ç±»çº§åˆ«çš„é™æ€æ–¹æ³•
- `getter`/`setter` ä½¿ç”¨ `get` å’Œ `set` å®šä¹‰å±æ€§çš„è®¿é—®å™¨
- `#` ç§æœ‰å­—æ®µ

:::details ES6 ç±»ç»§æ‰¿

```js
// ================== Animal çˆ¶ç±» ==================
class Animal {
  constructor(name) {
    this.name = name
  }

  speak() {
    console.log(`${this.name} å‘å‡ºå«å£°`)
  }

  static create(name) {
    return new Animal(name)
  }
}

// ================== Dog å­ç±» ==================
class Dog extends Animal {
  #breed // ç§æœ‰å­—æ®µ

  constructor(name, breed) {
    super(name) // è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
    this.#breed = breed
  }

  speak() {
    super.speak() // è°ƒç”¨çˆ¶ç±»æ–¹æ³•
    console.log(`${this.name} (${this.#breed})`)
  }

  static {
    // é™æ€åˆå§‹åŒ–å—ï¼ˆES2022ï¼‰
    console.log('Dog class åˆå§‹åŒ–')
  }
}

new Dog('ç‹—ç‹—', 'é‡‘æ¯›çŒçŠ¬').speak()
```

:::

### 2. ES5 åŸå‹ç»§æ‰¿

- `function Parent() {}` å®šä¹‰æ„é€ å‡½æ•°
- `prototype.constructor =` æ˜¾å¼è®¾ç½®æŒ‡å‘æ„é€ å‡½æ•°
- `this.prop =` å®šä¹‰å®ä¾‹å±æ€§
- `prototype.method =` å®šä¹‰å®ä¾‹æ–¹æ³•
- `Parent.method =` å®šä¹‰é™æ€æ–¹æ³•
- `Object.create(Parent.prototype)` åˆ›å»ºåŸå‹å¯¹è±¡ï¼Œå®ç°ç±»ç»§æ‰¿
- `Parent.call(this, ...args)` å­ç±»ç»§æ‰¿çˆ¶ç±»å®ä¾‹å±æ€§

:::details ES5 åŸå‹ç»§æ‰¿

```js
// ================== Animal çˆ¶ç±» ==================
let Animal = (function () {
  function Animal(name) {
    this.name = name
  }

  Animal.prototype.constructor = Animal
  Animal.prototype.speak = function () {
    console.log(`${this.name} å‘å‡ºå«å£°`)
  }
  Animal.create = function (name) {
    return new Animal(name)
  }

  return Animal
})()

// ================== Dog å­ç±» ==================
let Dog = (function () {
  function Dog(name, breed) {
    Animal.call(this, name)
    this._breed = breed
  }

  Dog.prototype.constructor = Dog
  Dog.prototype = Object.create(Animal.prototype)
  Dog.prototype.speak = function () {
    Animal.prototype.speak.call(this)
    console.log(`${this.name} (${this._breed})`)
  }
  ;(function () {
    console.log('Dog class åˆå§‹åŒ–')
  })()

  return Dog
})()

// æµ‹è¯•ç”¨ä¾‹
new Dog('ç‹—ç‹—', 'é‡‘æ¯›çŒçŠ¬').speak()
```

:::
