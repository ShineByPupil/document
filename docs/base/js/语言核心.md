# è¯­è¨€æ ¸å¿ƒ - JavaScript

## ä¸€ã€å˜é‡å£°æ˜

::: tip å†å²èƒŒæ™¯

ä»ES5çš„`var`åˆ°ES6çš„`let/const`ï¼ŒJavaScriptçš„å˜é‡å£°æ˜æœºåˆ¶ç»å†äº†é‡å¤§æ”¹è¿›ï¼Œä¸»è¦è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š

1. å˜é‡æå‡å¯¼è‡´çš„æ„å¤–è¡Œä¸º
2. å…¨å±€æ±¡æŸ“é—®é¢˜ï¼ˆå°¤å…¶æµè§ˆå™¨ç¯å¢ƒï¼‰
3. å¾ªç¯ä½œç”¨åŸŸé—®é¢˜
4. ç¼ºä¹çœŸæ­£çš„å¸¸é‡å£°æ˜

:::

| ç‰¹æ€§     | **`var`** | **`let`** | **`const`** |
|--------|-----------|-----------|-------------|
| ä½œç”¨åŸŸ    | å‡½æ•°çº§       | å—çº§        | å—çº§          |
| é‡å¤å£°æ˜   | å…è®¸âœ…       | ç¦æ­¢ğŸš«      | ç¦æ­¢ğŸš«        |
| æš‚æ—¶æ€§æ­»åŒº  | æ— âŒ        | æœ‰âœ…        | æœ‰âœ…          |
| å…¨å±€å±æ€§ç»‘å®š | æ˜¯         | å¦         | å¦           |

```js [å£°æ˜å¯¹æ¯”]
// ES5æ–¹å¼ï¼ˆå­˜åœ¨å˜é‡æå‡ï¼‰
console.log(hoistedVar) // undefined
var hoistedVar = 10

// ES6æ–¹å¼ï¼ˆå—çº§ä½œç”¨åŸŸï¼‰
{
    let blockScoped = 20
    const PI = 3.1415926
}

console.log(blockScoped) // ReferenceError
```

::: warning æ³¨æ„äº‹é¡¹

1. constå£°æ˜å¯¹è±¡æ—¶ï¼Œå±æ€§ä»å¯ä¿®æ”¹ï¼ˆéœ€é…åˆObject.freezeï¼‰
2. é¿å…åœ¨å¾ªç¯ä¸­ä½¿ç”¨varå£°æ˜è¿­ä»£å˜é‡

:::

## äºŒã€æ•°æ®ç±»å‹

### 1. åŸºæœ¬ç±»å‹

ä¸ƒå¤§ç±»ï¼š`String` \| `Number` \| `Boolean` \| `null` \| `underfind` \| `Symbol`(ES6+) \| `BigInt`(ES2020+)

### 2. å¼•ç”¨ç±»å‹

`Object` \| `Array` \|  `Function` \| `Map` \| `WeakMap` \| `Set` \| `Date` \| `RegExp` \| `Promise`

### 3. ç±»å‹åˆ¤æ–­

- `typeof`

```js
typeof 'str';     // "string"
typeof 42;        // "number"
typeof true;      // "boolean"
typeof Symbol();  // "symbol"
typeof {};        // "object"
typeof [];        // "object" (æ³¨æ„æ•°ç»„åˆ¤æ–­éœ€ç”¨Array.isArray())
typeof null;      // "object"
typeof undefined; // "undefined"
```

:::warning æ³¨æ„äº‹é¡¹

æ— æ³•åŒºåˆ†æ•°ç»„ã€nullä¸object

:::

- `Object.prototype.toString.call()`

```js
Object.prototype.toString.call('str');    // "[object String]"
Object.prototype.toString.call(42);       // "[object Number]"
Object.prototype.toString.call(true);     // "[object Boolean]"
Object.prototype.toString.call(Symbol()); // "[object Symbol]"
Object.prototype.toString.call({});       // "[object Object]"
Object.prototype.toString.call([]);       // "[object Array]"
```

- `instanceof`

```js
[] instanceof Array;                 // true
[] instanceof Object;                // true
'str' instanceof String;             // false
new Object('str') instanceof String; // true
```

:::warning æ³¨æ„äº‹é¡¹

1. åŸºæœ¬ç±»å‹æ— æ•ˆ
2. è·¨çª—å£/æ¡†æ¶å¯¹è±¡æ£€æµ‹å¤±æ•ˆï¼ˆä¸åŒä¸Šä¸‹æ–‡çš„æ„é€ å‡½æ•°ä¸å…±äº«åŸå‹é“¾ï¼‰
3. æ˜¾å¼ä¿®æ”¹åŸå‹é“¾å¯èƒ½å¯¼è‡´è¯¯åˆ¤ï¼ˆæ‰‹åŠ¨ä¿®æ”¹å¯¹è±¡çš„ `__proto__` æˆ–ä½¿ç”¨ `Object.setPrototypeOf` ä¼šå½±å“ `instanceof` çš„ç»“æœï¼‰

:::

- `Array.isArray()`

```js
Array.isArray([]);    // true
Array.isArray('str'); // false
```

- `Number.isNaN` å’Œ `isNaN`

```js
isNaN(NaN)          // true
Number.isNaN(NaN)   // true
isNaN('str')        // true
Number.isNaN('str') // false
```

## ä¸‰ã€ä½œç”¨åŸŸ

### 1. ä½œç”¨åŸŸç±»å‹

- å…¨å±€ä½œç”¨åŸŸ
- å‡½æ•°ä½œç”¨åŸŸ
- å—çº§ä½œç”¨åŸŸï¼ˆES6+ï¼‰

### 2. ä½œç”¨åŸŸé“¾

```js
let globalVar = 'global';

function outer() {
    let outerVar = 'outer';

    function inner() {
        let innerVar = 'inner';
        console.log(globalVar); // é€šè¿‡ä½œç”¨åŸŸé“¾å‘ä¸ŠæŸ¥æ‰¾
    }

    inner();
}

outer();
```

### 3. this æŒ‡å‘

ç»‘å®šè§„åˆ™

| è°ƒç”¨æ–¹å¼            | this æŒ‡å‘          | ç¤ºä¾‹                  |
|-----------------|------------------|---------------------|
| æ™®é€šå‡½æ•°è°ƒç”¨          | window/undefined | `func()`            |
| æ–¹æ³•è°ƒç”¨            | è°ƒç”¨å¯¹è±¡             | `obj.method()`      |
| new è°ƒç”¨          | æ–°åˆ›å»ºå®ä¾‹            | `new Constructor()` |
| call/apply/bind | æŒ‡å®šå¯¹è±¡             | `func.call(ctx)`    |

## å››ã€é—­åŒ…

:::tip å®šä¹‰

é—­åŒ…æ˜¯å‡½æ•°ä¸å…¶å£°æ˜æ—¶è¯æ³•ç¯å¢ƒçš„**ç»‘å®šå…³ç³»**ï¼Œä½¿å¾—å‡½æ•°å¯ä»¥æŒç»­è®¿é—®å…¶å¤–éƒ¨ä½œç”¨åŸŸçš„å˜é‡ï¼Œå³ä½¿å¤–å±‚å‡½æ•°å·²æ‰§è¡Œå®Œæ¯•ã€‚
è¿™ç§æœºåˆ¶é€šè¿‡ç»´æŒå˜é‡å¼•ç”¨é˜»æ­¢åƒåœ¾å›æ”¶ï¼Œæ˜¯ JavaScript å®ç°æ¨¡å—åŒ–å’ŒçŠ¶æ€ä¿æŒçš„æ ¸å¿ƒæ¨¡å¼ã€‚

:::

### 1. é—­åŒ…åº”ç”¨

- ç§æœ‰å±æ€§

```js
function createCounter() {
    let count = 0; // ç§æœ‰å˜é‡

    return {
        increment() {
            count++
        },
        get value() {
            return count
        }
    }
}
```

- é˜²æŠ–

```ts
function debounce(func: () => void, wait: number = 0): () => void {
    let timeoutID = 0;

    return function () {
        timeoutID && clearTimeout(timeoutID);
        timeoutID = setTimeout(func, wait);
    };
}

document.addEventListener("sroll", debounce(function () {
    // todo
}, 1000));
```

- èŠ‚æµ

```ts
function throttle(func: () => void, wait: number = 0): () => void {
}
```

### 2. é—­åŒ…ä¸ç±»çš„åŒºåˆ«

| ç‰¹æ€§    | **é—­åŒ…**            | **ç±»ï¼ˆClassï¼‰**     |
|-------|-------------------|------------------|
| çŠ¶æ€ç‹¬ç«‹æ€§ | æ¯æ¬¡è°ƒç”¨ç”Ÿæˆç‹¬ç«‹å®ä¾‹        | é€šè¿‡ `new` ç”Ÿæˆç‹¬ç«‹å®ä¾‹  |
| ç§æœ‰æ€§   | å˜é‡å¤©ç„¶ç§æœ‰ï¼ˆæ— æš´éœ²é€”å¾„ï¼‰     | éœ€è¦ `#` å‰ç¼€å£°æ˜ç§æœ‰å­—æ®µ  |
| å†…å­˜æ•ˆç‡  | æ¯ä¸ªå®ä¾‹ç‹¬ç«‹æŒæœ‰æ–¹æ³•ï¼ˆå†…å­˜å ç”¨é«˜ï¼‰ | æ–¹æ³•å…±äº«åœ¨åŸå‹ä¸Šï¼ˆå†…å­˜é«˜æ•ˆï¼‰   |
| ç»§æ‰¿    | æ— ç›´æ¥ç»§æ‰¿æœºåˆ¶ï¼Œéœ€æ‰‹åŠ¨ç»„åˆ     | 	æ”¯æŒ `extends` ç»§æ‰¿ |
| ä»£ç ç»“æ„  | é€‚åˆç®€å•é€»è¾‘ï¼Œå‡½æ•°å¼é£æ ¼      | é€‚åˆå¤æ‚å¯¹è±¡å»ºæ¨¡ï¼Œé¢å‘å¯¹è±¡é£æ ¼  |
| æ€§èƒ½    | é«˜é¢‘è°ƒç”¨æ—¶å¯èƒ½è¾ƒæ…¢ï¼ˆæ— ä¼˜åŒ–ï¼‰    | æ–¹æ³•è°ƒç”¨é€šå¸¸æ›´å¿«ï¼ˆå¼•æ“ä¼˜åŒ–ï¼‰   |
| åŠ¨æ€æ€§   | å¯åŠ¨æ€ç”Ÿæˆä¸åŒè¡Œä¸ºçš„å‡½æ•°      | è¡Œä¸ºç”±ç±»å®šä¹‰å›ºå®š         |

::: tip æ€§èƒ½è€ƒé‡

é—­åŒ…ä¼šå¯¼è‡´å†…å­˜é©»ç•™ï¼Œéœ€æ³¨æ„ï¼š
é¿å…ä¸å¿…è¦çš„é—­åŒ…åµŒå¥—
åŠæ—¶è§£é™¤ä¸å†ä½¿ç”¨çš„å¼•ç”¨
ä½¿ç”¨Chrome DevTools Memoryé¢æ¿åˆ†æ

:::

## äº”ã€Class ç±»

| å®ç°æ–¹å¼ | **ES5åŸå‹ç»§æ‰¿** | **ES6ç±»ç»§æ‰¿**     |
|------|-------------|----------------|
| è¯­æ³•   | å‡½æ•°+åŸå‹       | classè¯­æ³•ç³–       |
| é™æ€æ–¹æ³• | æ‰‹åŠ¨æ·»åŠ åˆ°æ„é€ å‡½æ•°   | staticå…³é”®å­—      |
| ç§æœ‰å­—æ®µ | çº¦å®šå¼ï¼ˆ_å‰ç¼€ï¼‰    | #è¯­æ³•æ”¯æŒ          |
| å…¼å®¹æ€§  | å…¨æµè§ˆå™¨æ”¯æŒ      | éœ€è¦transpilerè½¬æ¢ |
| å¯è¯»æ€§  | è¾ƒä½          | æ¥è¿‘ä¼ ç»ŸOOP        |

### 1. ES6ç±»ç»§æ‰¿

```js
// ================== Animal çˆ¶ç±» ==================
class Animal {
    constructor(name) {
        this.name = name;
    }

    speak() {
        console.log(`${ this.name } å‘å‡ºå«å£°`);
    }

    static create(name) {
        return new Animal(name);
    }
}

// ================== Dog å­ç±» ==================
class Dog extends Animal {
    #breed; // ç§æœ‰å­—æ®µ

    constructor(name, breed) {
        super(name); // è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
        this.#breed = breed;
    }

    speak() {
        super.speak(); // è°ƒç”¨çˆ¶ç±»æ–¹æ³•
        console.log(`${ this.name } (${ this.#breed })`);
    }

    static {
        // é™æ€åˆå§‹åŒ–å—ï¼ˆES2022ï¼‰
        console.log('Dog class åˆå§‹åŒ–');
    }
}

new Dog('ç‹—ç‹—', 'é‡‘æ¯›çŒçŠ¬').speak();
```

### 2. ES5åŸå‹ç»§æ‰¿

```js
// ================== Animal çˆ¶ç±» ==================
let Animal = (function () {
    function Animal(name) {
        this.name = name;
    }

    Animal.prototype.constructor = Animal;
    Animal.prototype.speak = function () {
        console.log(`${ this.name } å‘å‡ºå«å£°`);
    }
    Animal.create = function (name) {
        return new Animal(name);
    }

    return Animal;
})()

// ================== Dog å­ç±» ==================
let Dog = (function () {
    function Dog(name, breed) {
        Animal.call(this, name);
        this._breed = breed;
    }

    Dog.prototype.constructor = Dog;
    Dog.prototype = Object.create(Animal.prototype);
    Dog.prototype.speak = function () {
        Animal.prototype.speak.call(this);
        console.log(`${ this.name } (${ this._breed })`);
    };

    (function () {
        console.log("Dog class åˆå§‹åŒ–");
    })();

    return Dog;
})()

// æµ‹è¯•ç”¨ä¾‹
new Dog("ç‹—ç‹—", "é‡‘æ¯›çŒçŠ¬").speak();
```

