# 布局系统

> 现代Web布局解决方案

## 传统文档流布局

### 块级元素

- **核心特性**:
    - 默认占据父容器整行宽度（`width: 100%`）
    - 可定义尺寸属性（`width`/`height`/`padding`/`margin`）
    - 垂直方向依次排列（即使容器有剩余空间）
- 常见标签：`div`, `p`, `h1` - `h6`, `ul`, `li`, `section`

### 行内元素

- **核心特性**:
    - 默认同行排列，宽度由内容决定
    - 无法直接设置宽高（需通过display: inline-block转换）
    - 仅支持水平方向的`padding`/`margin`
- 常见标签：`span`, `a`, `strong`, `em`, `img`, `input`

### display属性详解

**基础显示模式**

| 属性值            | 核心特性               | 典型应用场景    |
|----------------|--------------------|-----------|
| `block`        | 占据整行，可设置宽高，垂直排列    | 段落、容器区块   |
| `inline`       | 行内排列，不可设置宽高，默认内容宽度 | 文字修饰元素    |
| `inline-block` | 行内排列但保留块级特性，可设置宽高  | 导航按钮、图标布局 |
| `none`         | 完全从渲染树移除，不占据空间     | 动态显示/隐藏元素 |

**现代布局模式**

| 属性值           | 布局特性                  | 核心优势         |
|---------------|-----------------------|--------------|
| `flex`        | 弹性盒子布局，一维布局，支持动态伸缩    | 响应式排列、对齐控制   |
| `inline-flex` | 行内级弹性容器，外部表现为inline特性 | 内联菜单、紧凑布局    |
| `grid`        | 网格布局，二维布局，精准行列控制      | 复杂卡片布局、杂志式排版 |
| `inline-grid` | 行内级网格容器               | 内嵌网格内容       |

**特殊显示模式**

| 属性值         | 核心特性                                | 注意要点                  |
|-------------|-------------------------------------|-----------------------|
| `flow-root` | 创建新的BFC上下文，解决浮动塌陷                   | 替代 `overflow: hidden` |
| `contents`  | 元素自身不渲染，子元素提升到父级层级                  | 影响无障碍访问，慎用！           |
| `table`     | 模拟表格布局 (table/table-row/table-cell) | 传统布局方式，逐渐被Flex/Grid替代 |
| `list-item` | 元素表现为列表项，生成`::marker`               | 自定义列表符号时使用            |

**复合属性值（CSS3+）**

| 属性值                   | 	作用描述                |
|-----------------------|----------------------|
| `block flex`          | 外部表现为块级容器，内部启用Flex布局 |
| `inline grid`         | 外部表现为行内容器，内部启用Grid布局 |
| `flow-root list-item` | 同时创建BFC和列表项标记        |

### 默认流式布局特性

> 自动换行规则：块级元素垂直排列，行内元素水平排列直至容器宽度不足

**外边距塌陷（Margin Collapsing）**

- 触发条件：
    1. 相邻兄弟元素的垂直边距
    2. 父元素与第一个/最后一个子元素的边距
    3. 空块级元素的上下边距
- 解决方案：
    1. 添加边框或内边距
    2. 创建BFC
    3. 使用flex/grid布局

## Flexbox 弹性盒子布局(一维)

> 基于**一维流式布局模型**，通过弹性容器（Flex Container）控制子元素在主轴（Main Axis）与交叉轴（Cross
> Axis）上的排列、对齐和空间分配，为响应式布局和动态内容适配提供了高效解决方案。

| 概念      | 定义              | 相关属性                             |
|---------|-----------------|----------------------------------|
| **主轴**  | 项目排列的主要方向       | `flex-direction`                 |
| **交叉轴** | 垂直于主轴的方向        | `align-items`, `align-self`      |
| **容器**  | 控制内部项目的布局       | `display: flex`                  |
| **项目**  | 容器的直接子元素        | `order`, `flex-grow`             |
| **伸缩性** | 项目在主轴上的扩展/收缩能力  | `flex-grow`, `flex-shrink`       |
| **换行**  | 项目超出容器时是否换行显示   | `flex-wrap`                      |
| **对齐**  | 项目在主轴和交叉轴上的分布方式 | `justify-content`, `align-items` |

### 父容器属性 (flex container)

:::demo onlyShow
base/css/FlexContainer/index
:::

| 属性名                   | 可选值                                                                                                            | 说明                        |
|-----------------------|----------------------------------------------------------------------------------------------------------------|---------------------------|
| **`display`**         | `flex` \| `inline-flex`                                                                                        | 定义弹性容器                    |
| **`flex-direction`**  | - `row`（默认值）<br>- `row-reverse`<br>- `column`<br>- `column-reverse`                                            | 主轴方向                      |
| **`flex-wrap`**       | - `nowrap`（默认值）<br>- `wrap`<br>- `wrap-reverse`                                                                | 换行方式<br>(单/多行)            |
| **`justify-content`** | - `flex-start`（默认值）<br>- `flex-end`<br>- `center`<br>- `space-between`<br>- `space-around`<br>- `space-evenly` | 主轴对齐                      |
| **`align-items`**     | - `stretch`（默认值）<br>- `flex-start`<br>- `flex-end`<br>- `center`<br>- `baseline`                               | (单行)交叉轴对齐                 |
| **`align-content`**   | - `stretch`（默认值）<br>- `flex-start`<br>- `flex-end`<br>- `center`<br>- `space-between`<br>- `space-around`      | (多行)交叉轴对齐                 |
| **`gap`**             | - `<length>`（默认值0）<br>- `[row-gap] [column-gap]`                                                               | 项目间距                      |
| **`place-content`**   | `[justify-content] [align-content]`                                                                            | ● 双值简写属性<br>● 省略第二个值时取相同值 |

### 子项目属性 (flex item)

:::demo onlyShow
base/css/FlexItemController/index
:::

| 属性名               | 可选值                                                                                          | 说明          |
|-------------------|----------------------------------------------------------------------------------------------|-------------|
| **`order`**       | `<integer>`（默认值0）                                                                            | 项目排序，从小到大   |
| **`flex-grow`**   | `<number>`（默认值0）                                                                             | 扩展比例，0=不扩展  |
| **`flex-shrink`** | `<number>`（默认值1）                                                                             | 收缩比例，0=禁止收缩 |
| **`flex-basis`**  | `<width>` \| `content`                                                                       | 初始尺寸        |
| **`align-self`**  | - `auto`（默认值）<br>- `stretch`<br>- `flex-start`<br>- `flex-end`<br>- `center`<br>- `baseline` | 交叉轴对齐方式     |

### 聚合属性 flex

| 简写格式                   | 等效展开                     | 参数说明                                                         |
|------------------------|--------------------------|--------------------------------------------------------------|
| **单值语法**               |                          |                                                              |
| `flex: <number>`       | `flex: <number> 1 0%`    | `[grow] = <number>`<br> `[shrink] = 1`<br> `[basis] = 0%`    |
| `flex: <length>`       | `flex: 1 1 <length>`     | `[grow] = 1`<br> `[shrink] = 1`<br> `[basis]` = `<length>`   |
| `flex: none`           | `flex: 0 0 auto`         | - 禁止伸缩的固定尺寸项目                                                |
| **双值语法**               |                          |                                                              |
| `flex: <num> <num>`    | `flex: <num1> <num2> 0%` | `[grow] = <num1>`<br> `[shrink] = <num2>`<br> `[basis] = 0%` |
| `flex: <num> <length>` | `flex: <num> 1 <length>` | `[grow] = <num>`<br> `[shrink] = 1`<br> `[basis] = <length>` |
| **三值语法**               |                          |                                                              |
| `flex: <g> <s> <b>`    | 完全显式声明                   | `[grow] = <g>`<br> `[shrink] = <s>`<br> `[basis] = <b>`      |

## Grid 网格布局(二维)

> 基于**二维网格的布局模型**，将容器划分为行（Row）与列（Column），并精准控制子元素的排列规则，彻底改变了传统布局方式

:::demo onlyShow
base/css/GridContainer/GridDemo
:::

| 概念             | 定义                           | 相关属性                                                 |
|----------------|------------------------------|------------------------------------------------------|
| **轨道 (Track)** | 网格的行或列，定义显式轨道                | - `grid-template-columns` <br>- `grid-template-rows` |
| **隐式轨道**       | 当项目超出显式网格时自动创建的轨道            | - `grid-auto-rows` <br>- `grid-auto-columns`         |
| **网格线 (Line)** | 轨道之间的分隔线，可命名用于精确定位           | - `grid-column-start` <br>- `grid-column-end`        |
| **单元格 (Cell)** | 网格中行和列的交叉区域<br>（最小的布局单元）     | 自动生成                                                 |
| **区域 (Area)**  | 一个或多个连续单元格组成的矩形区域<br>（需预先命名） | `grid-template-areas`                                |
| **间隙 (Gap)**   | 轨道之间的间距                      | `gap` \| `row-gap` \| `column-gap`                   |
| **流控制**        | 自动放置项目的算法规则                  | `grid-auto-flow`                                     |

### 父容器属性 (grid container)

| 属性名                         | 可选值                                                                                              | 说明                                      |
|-----------------------------|--------------------------------------------------------------------------------------------------|-----------------------------------------|
| **`display`**               | `grid` \| `inline-grid`                                                                          | 定义容器为网格布局                               |
| **`grid-template-columns`** | `<track-size>` \| `<line-name>`                                                                  | 显式定义**列轨道**的尺寸和线名                       |
| **`grid-template-rows`**    | `<track-size>` \| `<line-name>`                                                                  | 显式定义**行轨道**的尺寸和线名                       |
| **`grid-template-areas`**   | `"<area-name> ..."`                                                                              | 通过命名区域定义布局，子项通过 `grid-area` 引用名称。区域需为矩形 |
| **`grid-auto-columns`**     | `<track-size>`                                                                                   | 定义**隐式列轨道**尺寸<br>(当项目超出显式网格时)           |
| **`grid-auto-rows`**        | `<track-size>`                                                                                   | 定义**隐式行轨道**尺寸                           |
| **`grid-auto-flow`**        | `row` \| `column` \| `row dense` \| `column dense`                                               | 控制自动放置算法流向<br>`dense` 表示尽量填满空隙          |
| **`gap`**                   | `[row-gap] [column-gap]`                                                                         | 网格间距                                    |
| **`align-items`**           | `start` \| `end` \| `center` \| `stretch`                                                        | 控制单元格内项目的垂直对齐方式                         |
| **`justify-items`**         | `start` \| `end` \| `center` \| `stretch`                                                        | 控制单元格内项目的水平对齐方式                         |
| **`place-items`**           | `[align-items] [justify-items]`                                                                  | 复合属性                                    |
| **`align-content`**         | `start` \| `end` \| `center` \| `stretch` \| `space-around` \| `space-between` \| `space-evenly` | 整个网格在容器中的**垂直**分布方式                     |
| **`justify-content`**       | 同上                                                                                               | 整个网格在容器中的**水平**分布方式                     |
| **`place-content`**         | `[align-content] [justify-content]`                                                              | 复合属性                                    |

### 子项目属性 (grid item)

| 属性名                     | 可选值                                                                            | 说明                                                |
|-------------------------|--------------------------------------------------------------------------------|---------------------------------------------------|
| **`grid-column-start`** | `<number>` \| `<line-name>` \| `span <number>` \| `span <line-name>` \| `auto` | 指定项目在列方向上的起始位置（通过线号、线名或跨越轨道数）。auto 表示自动放置         |
| **`grid-column-end`**   | 同上                                                                             | 指定项目在列方向上的**结束位置**                                |
| **`grid-row-start`**    | 同上                                                                             | 指定项目在行方向上的**起始位置**                                |
| **`grid-row-end`**      | 同上                                                                             | 指定项目在行方向上的**结束位置**                                |
| **`grid-column`**       | `<start-line> / <end-line>`                                                    | 简写属性。同时定义 `grid-column-start` 和 `grid-column-end` |
| **`grid-row`**          | `<start-line> / <end-line>`                                                    | 简写属性，同时定义 `grid-row-start` 和 `grid-row-end`       |
| **`grid-area`**         | `<name>` \| `<row-start> / <column-start>` \| `<row-end> / <column-end>`       | 定义项目所属的命名区域（需父容器定义 `grid-template-areas`）         |
| **`justify-self`**      | `start` \| `end` \| `center` \| `stretch`                                      | 控制单个项目在单元格内的**水平对齐方式**                            |
| **`align-self`**        | 同上                                                                             | 控制单个项目在单元格内的**垂直对齐方式**                            |
| **`place-self`**        | `[align-self] [justify-self]`                                                  | 简写属性                                              |

### grid属性

| 语法形式                                | 等效展开                                                                          | 说明                  |
|-------------------------------------|-------------------------------------------------------------------------------|---------------------|
| `grid: none`                        | `grid-template: none`                                                         | 重置所有显式网格定义          |
| `grid: subgrid`                     | `grid-template: subgrid`                                                      | 继承父网格轨道（需父元素为网格）    |
| `grid: masonry`                     | `grid-template: masonry`                                                      | 瀑布流布局（仅 Firefox 支持） |
| `grid: auto-flow`                   | `grid-auto-flow: row`                                                         | 自动行排列（隐式轨道）         |
| `grid: <track-list>`                | `grid-template: <track-list>`                                                 | 定义显式网格轨道            |
| `grid: 100px 1fr / auto-flow`       | `grid-template-rows: 100px 1fr;`<br>`grid-auto-flow: column;`                 | 显式行 + 自动列流          |
| `grid: auto-flow dense / 200px`     | `grid-auto-flow: row dense;`<br>`grid-auto-rows: 200px;`                      | 自动行密集排列 + 隐式行尺寸     |
| `grid: [a] 1fr [b] / [x] 100px [y]` | `grid-template-rows: [a] 1fr [b];`<br>`grid-template-columns: [x] 100px [y];` | 命名网格线定义             |

### 轨道尺寸定义

| 语法              | 示例                            | 说明                                                     |
|-----------------|-------------------------------|--------------------------------------------------------|
| `fr` 单位         | `1fr` `minmax(200px, 2fr)`    | **弹性单位**：按比例分配剩余空间                                     |
| `repeat()`	     | `repeat(3, 1fr)`              | **重复模式**：<br>`auto-fill` (自动填充) <br> `auto-fit` (自动适应) |
| `minmax()`      | `minmax(100px, 1fr)`          | **尺寸范围**：定义轨道的最小和最大尺寸                                  |
| `masonry`       | `grid-template-rows: masonry` | **瀑布流布局** <br> (实验性特性，需浏览器支持)                          |
| `固定单位`          | `100px` `20%` `5em`           | 固定尺寸或百分比，直接定义轨道宽度/高度                                   |
| `auto`          | `auto`                        | 自动尺寸：由内容撑开                                             |
| `fit-content()` | `fit-content(200px)`          | 限制轨道尺寸不超过指定值，同时允许收缩到内容的最小尺寸                            |

### Grid vs Flexbox 对比决策表

| 特性         | Grid                          | Flexbox         | 胜出场景                     |
|------------|-------------------------------|-----------------|--------------------------|
| **布局维度**   | 二维（行列同时控制）                    | 一维（主轴+交叉轴）      | Grid：复杂网格布局<br>Flex：线性排列 |
| **内容流控制**  | 显式定位，可打破DOM顺序                 | 严格遵循DOM顺序       | Grid：视觉重排需求              |
| **对齐控制**   | 容器和项目双向对齐                     | 主轴优先，交叉轴次之      | Grid：复杂对齐需求              |
| **响应式适配**  | `auto-fill`/`auto-fit` 自动计算列数 | 需手动计算百分比或媒体查询   | Grid：自适应布局更高效            |
| **嵌套布局**   | `subgrid` 继承父网格               | 需多层嵌套容器         | Grid：减少嵌套层级              |
| **典型应用场景** | 仪表盘、杂志排版、表单系统                 | 导航菜单、卡片列表、表单控件组 | 根据复杂度选择                  |

## 定位与层叠

### position 定位模式

    - 补充：sticky定位详解 

### z-index 层叠上下文规则

    - 新增：transform/opacity创建条件

### 定位元素的百分比计算基准

## 浮动布局（历史方案）

### 浮动元素的包裹特性

### 清除浮动方案演进

    - 传统：clearfix hack
    - 现代：flow-root属性

### 浮动与形状环绕

## 响应式布局

### 媒体查询与断点策略

### 视口单位进阶应用

    - 补充：vmin/vmax使用场景

### 容器查询实践

    - 增加：cqw/cqh单位

## 多列布局

### column属性全解析

    - 包含：column-rule/column-fill

### 跨列元素处理

    - 明确：column-span: all的兼容性

### 流式分栏与固定高度分栏

## 布局技巧与常见问题

### 全场景居中方案

    - 区分：传统定位 vs Flex/Grid现代方案

### 等高列实现对比

    - 增加：CSS Grid方案

### 内容溢出处理

    - 补充：scroll-snap应用

### 布局性能优化

    - 增加：content-visibility属性
