# 核心机制

:::info 构建样式的基础规则

:::

## 一、盒模型

> CSS 布局的核心基础，将每个 HTML 元素抽象为多层矩形结构。

:::demo onlyShow
base/css/BoxModel
:::

| 特性       | 标准盒模型         | IE盒模型                     |
| ---------- | ------------------ | ---------------------------- |
| box-sizing | `content-box`      | `border-box`                 |
| 标准归属   | W3C CSS2.1+        | IE6/7 Quirks Mode            |
| 宽高计算   | `content`          | `content + padding + border` |
| 布局影响   | 需要手动计算总尺寸 | 自动包含内边距和边框         |

## 二、基本选择器

> CSS 样式规则的基础定位工具。

### 1. 元素选择器

- **语法**：`element { ... }`
- **作用**：选中所有指定 HTML 元素。
- **示例**：
  ```css
  /* 所有 <p> 元素 */
  p {
    color: red;
  }
  ```

### 2. 类选择器

- **语法**：`.class-name { ... }`
- **作用**：可重复使用，推荐语义化命名
- **示例**：
  ```css
  /* 所有 class="text-bold" 的元素 */
  .text-bold {
    font-weight: bold;
  }
  ```

### 3. ID选择器

- **语法**：`#id-name { ... }`
- **作用**：具有唯一性，用于精准定位
- **示例**：
  ```css
  /* 选择 id="main-nav" 的元素 */
  #main-nav {
    height: 60px;
  }
  ```

### 4. 通配符选择器

- **语法**：`* { ... }`
- **作用**：选中所有元素（慎用）
- **注意**：在大型项目或复杂DOM中会显著增加样式计算时间
- **示例**：
  ```css
  /* 全局重置外边距 */
  * {
    margin: 0;
  }
  ```

## 三、组合选择器

> 通过运算符（空格、`>`、`+`、`~`）联结多个基础选择器。

### 1. 后代选择器

- **语法**：`selector1 selector2 { ... }`
- **作用**：选中 parent 内部的所有 child。
- **示例**：
  ```css
  /* div 内的所有 p */
  div p {
    color: green;
  }
  ```

### 2. 子元素选择器

- **语法**：`selector1 > selector2 { ... }`
- **作用**：仅选中直接子元素。
- **示例**：
  ```css
  /* ul 的直接子 li */
  ul > li {
    list-style: none;
  }
  ```

### 3. 相邻兄弟选择器

- **语法**：`selector1 + selector2 { ... }`
- **作用**：匹配紧邻的下一个兄弟元素
- **示例**：
  ```css
  /* 紧接在 h2 后的段落 */
  h2 + p {
    margin-top: 0;
  }
  ```

### 4. 通用兄弟选择器

- **语法**：`selector1 ~ selector2 { ... }`
- **作用**：匹配后续所有同级元素
- **示例**：
  ```css
  /* h2 后的所有同级 p */
  h2 ~ p {
    color: gray;
  }
  ```

## 四、伪类与伪元素

> CSS 选择器的扩展机制，通过语法标记（`:` 与 `::`）精准定位元素的特定状态或虚拟子结构。

### 1. 伪类

> 基于元素状态、位置或上下文动态匹配。

- **语法**：`selector:pseudo-class { ... }`
- **作用**：定义元素的特殊状态（如交互状态）。
- **示例**：
  ```css
  /* 鼠标悬停时的链接 */
  a:hover {
    color: orange;
  }
  /* 第二个 li */
  li:nth-child(2) {
    background: yellow;
  }
  ```

:::details 伪类快速参考表

| 分类     | 伪类              | 语法示例                        | 描述                                 |
| -------- | ----------------- | ------------------------------- | ------------------------------------ |
| 状态伪类 | `:hover`          | `a:hover { ... }`               | 鼠标悬停时触发                       |
|          | `:active`         | `button:active { ... }`         | 元素被激活（如点击）时               |
|          | `:focus`          | `input:focus { ... }`           | 获得焦点时                           |
|          | `:visited`        | `a:visited { ... }	`             | 已访问过的链接                       |
| 结构伪类 | `:nth-child(n)`   | `li:nth-child(2n)`              | 匹配第偶数个子元素                   |
|          | `:first-child`    | `ul > li:first-child`           | 第一个子元素                         |
|          | `:last-child`     | `div:last-child`                | 最后一个子元素                       |
|          | `:nth-of-type(n)` | `p:nth-of-type(2)`              | 匹配同级中第2个指定类型元素          |
| 表单伪类 | `:checked`        | `input:checked, option:checked` | 被选中的表单控件                     |
|          | `:disabled`       | `input:disabled { ... }`        | 禁用状态的表单元素                   |
|          | `:valid`          | `input:valid { ... }`           | 输入内容通过验证时                   |
| 逻辑伪类 | `:not()`          | `div:not(.hidden)`              | 反向选择器                           |
|          | `:is()`           | `:is(h1,h2,h3)`                 | 分组匹配选择器                       |
| 动态伪类 | `:focus-visible`  | `button:focus-visible`          | 键盘聚焦时显示（不触发鼠标点击聚焦） |
|          | `:target`         | `#section:target`               | URL片段标识符匹配的元素              |
| 语言伪类 | `:lang()`         | `:lang(en)`                     | 根据元素lang属性匹配                 |

:::

### 2. 伪元素

> 抽象出文档流外的虚拟节点，用于装饰性内容或样式注入。

- **语法**：`selector::pseudo-element { ... }`
- **作用**：选中元素的某个部分（如首行）。
- **示例**：
  ```css
  p::first-line {
    font-weight: bold;
  } /* 段落的首行 */
  .box::before {
    content: '→';
  } /* 在 .box 前插入内容 */
  ```

## 五、特异性

> CSS 选择器的优先级计算规则，用于解决样式冲突时确定最终生效的样式。其通过权重层级量化选择器优先级。

:::tip 最佳实践
尽量使用类选择器，保持特异性层级简单可维护
:::

**特异性计算规则**

特异性由三组数字表示：`(a, b, c)`，比较时从左到右逐级对比：

- a：ID 选择器的数量。
- b：类选择器、属性选择器、伪类的数量。
- c：元素选择器的数量。

**示例**

| 选择器               | 特异性      | 解释                    |
| -------------------- | ----------- | ----------------------- |
| `#nav`               | `(1, 0, 0)` | 1个ID                   |
| `.menu li`           | `(0, 1, 1)` | 1个类 + 1个元素         |
| `input[type="text"]` | `(0, 1, 1)` | 1个属性选择器 + 1个元素 |
| `div:hover`          | `(0, 1, 1)` | 1个伪类 + 1个元素       |

**优先级**

1. 内联样式（如 \<div style="...">） > ID > 类 > 元素。
2. 特异性相同时，后定义的样式覆盖前者。
3. `!important` 强制最高优先级，会破坏样式层叠规则，导致维护困难（仅限工具类/覆盖第三方库时谨慎使用）
